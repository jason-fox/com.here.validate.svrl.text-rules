language: java
sudo: required
dist: bionic

jdk:
  - openjdk10

addons:
  apt:
    packages:
      - ant
  sonarcloud:
    organization: "dita-ot-plugins"
    token:
      secure: "OJqqmsagzwT7PRvPy+PlfQ8Fmv/dzMcSG6Egnk8qmnZtpmgOGx5jPFMaq1cPPUW1HMdVRktZIt75KXg0mR9sCAsf6uL4sBPTRKuL/+7JOauZhwyBDwwYmQv/pOoPW4voEXreEWUW4K6homXpHHiGAOXYzTI8MNAZvXxQWqQNbOGznqb63z0Sa6BXhrvUf1wBsXgcfrB3AM7Qba+FVUTDHBThwNjxRALlk6qw2n6nzYlZXC/5SxriGeypifGlHyoJ3dV9hDgIJrfoPhzre4Sgq3q881+OYLGn7KrMFctmo+SEtROlW6EhaEtvGd05DXcH18pRTqTIb/Ns87/Kb/s2mV7bpA14Ma3ApyDjS0tHRE/e/mKAPUiufky2Ct0nFSCxhG9dz58xqJEVUbEgCH3Tx9arVE0yjxQI2lpWKHm5BgqF49WZjFtsO8qrWMiYN0WgqbMMSWIfqj03927rsWR3eQEnsPKusv1s6w7K+P3MywFJU8JNtd9e3AdZGDPzKomnJtjAHBP90DVxuJW41OtOQGGzZ0n8A9MlcswM/ZSSzNNCeeNZm0RzmMNKoxoZNzFy9HLtV7G80L5R5ZAy4LZJ84/iM26blhuNy+QbyV85Yj9QRKxU//9NYwRAug63hguRLjoDnTovZP0xPFqR/DLnUXVtqvhqtHTBzmkbwjSiBVg="

env:
  - DITA_OT=3.3.4
  
before_install:
  - zip -r com.here.validate.svrl.text-rules.zip . -x *.zip* *.git/* *temp/* *out/*
  - curl -LO https://github.com/dita-ot/dita-ot/releases/download/$DITA_OT/dita-ot-$DITA_OT.zip
  - unzip -q dita-ot-$DITA_OT.zip
  - chmod +x dita-ot-$DITA_OT/bin/dita

install:
  - dita-ot-$DITA_OT/bin/dita --install https://github.com/jason-fox/fox.jason.unit-test/archive/master.zip
  - dita-ot-$DITA_OT/bin/dita --install https://github.com/doctales/org.doctales.xmltask/archive/master.zip
  - dita-ot-$DITA_OT/bin/dita --install https://github.com/jason-fox/com.here.validate.svrl/archive/master.zip
  - dita-ot-$DITA_OT/bin/dita --install com.here.validate.svrl.text-rules.zip
 
before_script:
  - dita-ot-$DITA_OT/bin/dita --input dita-ot-$DITA_OT/plugins/com.here.validate.svrl.text-rules -f xsl-instrument

script:
  - travis_wait dita-ot-$DITA_OT/bin/dita --input dita-ot-$DITA_OT/plugins/com.here.validate.svrl.text-rules -f unit-test --output . -v

after_success:
  - cp dita-ot-$DITA_OT/plugins/fox.jason.unit-test/resource/pom.xml pom.xml
  - mvn clean org.eluder.coveralls:coveralls-maven-plugin:report
  - rm -rf dita-ot-$DITA_OT
  - sonar-scanner
